
//load core module - "events"
var events = require('events');

//create instance of event emitter
var emitter = new events.EventEmitter();

//default is 10
emitter.setMaxListeners(15);

//async method
function authenticate(uid, pwd, success, failed) {
	//register for event call backs and events with emitter
	emitter.on('LOGIN_FAILED', failed);
	emitter.on('LOGIN_SUCCESS', success);

	if (uid == 'user1' && pwd == 'pwd1') {
		//trigger success event
		if (emitter.listeners('LOGIN_SUCCESS').length > 0) {
			var user = { userName : 'James', roles : ['admin', 'dev'] };
			//emitter.emit('LOGIN_SUCCESS', undefined, user);

			//incase of exceptions
			var err = { errText : 'Authentication success, but failed to get the user data' };
			emitter.emit('LOGIN_SUCCESS', err, {});
		}
	} else {
		//trigger failed event
		var err = { errText : 'Invalid credentials' };
		emitter.emit('LOGIN_FAILED', err);
	}
}

console.log(emitter);
exports.signIn = authenticate;